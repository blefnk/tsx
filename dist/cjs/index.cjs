"use strict";var x=require("path"),E=require("fs"),S=require("module"),a=require("get-tsconfig"),g=require("../source-map.cjs"),p=require("../index-9b548b9c.cjs"),q=require("../resolve-ts-path-43f50656.cjs");require("source-map-support"),require("../node-features-72f7f76d.cjs"),require("url"),require("esbuild"),require("crypto"),require("os");function l(s){return s&&typeof s=="object"&&"default"in s?s:{default:s}}var f=l(x),O=l(E),i=l(S);const b=/^\.{1,2}\//,M=/\.[cm]?tsx?$/,P=`${f.default.sep}node_modules${f.default.sep}`,u=process.env.ESBK_TSCONFIG_PATH?{path:f.default.resolve(process.env.ESBK_TSCONFIG_PATH),config:a.parseTsconfig(process.env.ESBK_TSCONFIG_PATH)}:a.getTsconfig(),T=u&&a.createFilesMatcher(u),h=u&&a.createPathsMatcher(u),F=g.installSourceMapSupport(),d=i.default._extensions,A=d[".js"],N=[".cts",".mts",".ts",".tsx",".jsx"],R=[".js",".cjs",".mjs"],D=/\b(?:import|export)\b/,y=(s,e)=>{process.send&&process.send({type:"dependency",path:e});const o=N.some(t=>e.endsWith(t)),n=R.some(t=>e.endsWith(t));if(!o&&!n)return A(s,e);let r=O.default.readFileSync(e,"utf8");if(e.endsWith(".cjs")){const t=p.transformDynamicImport(e,r);t&&(r=F(t,e))}else if(o||D.test(r)){const t=p.transformSync(r,e,{tsconfigRaw:T==null?void 0:T(e)});r=F(t,e)}s._compile(r,e)};[".js",".ts",".tsx",".jsx"].forEach(s=>{d[s]=y}),Object.defineProperty(d,".mjs",{value:y,enumerable:!1});const m=i.default._resolveFilename.bind(i.default);i.default._resolveFilename=(s,e,o,n)=>{var r;if(h&&!b.test(s)&&!((r=e==null?void 0:e.filename)!=null&&r.includes(P))){const c=h(s);for(const v of c){const _=j(v,e,o,n);if(_)return _;try{return m(v,e,o,n)}catch{}}}const t=j(s,e,o,n);return t||m(s,e,o,n)};const j=(s,e,o,n)=>{const r=q.resolveTsPath(s);if(e!=null&&e.filename&&M.test(e.filename)&&r)try{return m(r[0],e,o,n)}catch(t){const{code:c}=t;if(c!=="MODULE_NOT_FOUND"&&c!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw t}};
