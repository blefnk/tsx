import f from"path";import F from"fs";import m from"module";import{parseTsconfig as y,getTsconfig as S,createFilesMatcher as j,createPathsMatcher as E}from"get-tsconfig";import{installSourceMapSupport as O}from"../source-map.mjs";import{p as g,a as b,b as P}from"../index-dcf242e7.mjs";import{r as M}from"../resolve-ts-path-a8cb04a4.mjs";import"source-map-support";import"../node-features-18fdd9fd.mjs";import"url";import"esbuild";import"crypto";import"os";const A=/\b(?:import|export)\b/,N=t=>{if(A.test(t)){const[s,r]=g(t);return s.length>0||r.length>0}return!1},R=/^\.{1,2}\//,I=/\.[cm]?tsx?$/,C=`${f.sep}node_modules${f.sep}`,a=process.env.TSX_TSCONFIG_PATH?{path:f.resolve(process.env.TSX_TSCONFIG_PATH),config:y(process.env.TSX_TSCONFIG_PATH)}:S(),u=a&&j(a),_=a&&E(a),v=O(),l=m._extensions,D=l[".js"],G=[".cts",".mts",".ts",".tsx",".jsx"],H=[".js",".cjs",".mjs"],h=(t,s)=>{process.send&&process.send({type:"dependency",path:s});const r=G.some(o=>s.endsWith(o)),n=H.some(o=>s.endsWith(o));if(!r&&!n)return D(t,s);let e=F.readFileSync(s,"utf8");if(s.endsWith(".cjs")){const o=b(s,e);o&&(e=v(o,s))}else if(r||N(e)){const o=P(e,s,{tsconfigRaw:u==null?void 0:u(s)});e=v(o,s)}t._compile(e,s)};[".js",".ts",".tsx",".jsx"].forEach(t=>{l[t]=h}),Object.defineProperty(l,".mjs",{value:h,enumerable:!1});const p=m._resolveFilename.bind(m);m._resolveFilename=(t,s,r,n)=>{var e;const o=t.indexOf("?");if(o!==-1&&(t=t.slice(0,o)),_&&!R.test(t)&&!((e=s==null?void 0:s.filename)!=null&&e.includes(C))){const i=_(t);for(const d of i){const T=x(d,s,r,n);if(T)return T;try{return p(d,s,r,n)}catch{}}}const c=x(t,s,r,n);return c||p(t,s,r,n)};const x=(t,s,r,n)=>{const e=M(t);if(s!=null&&s.filename&&I.test(s.filename)&&e)for(const o of e)try{return p(o,s,r,n)}catch(c){const{code:i}=c;if(i!=="MODULE_NOT_FOUND"&&i!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw c}};
